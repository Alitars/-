"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,a,e){return a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t}var _dialog=require("../../../dist/dialog/dialog"),_dialog2=_interopRequireDefault(_dialog),_notify=require("../../../dist/notify/notify"),_notify2=_interopRequireDefault(_notify),_template=require("../../../template/template.js"),_template2=_interopRequireDefault(_template),_toast=require("../../../dist/toast/toast"),_toast2=_interopRequireDefault(_toast),_network=require("../../../template/network.js"),_network2=_interopRequireDefault(_network),_setTime=require("../../../template/setTime.js"),_setTime2=_interopRequireDefault(_setTime),_func=require("../../../template/func.js"),_func2=_interopRequireDefault(_func),main_Url=getApp().globalData.main_Url,time=require("../../../utils/util.js");Page({data:{active:0,value:"",id:1,animationData:"",width:"",height:"",wid:"",show:"",SafeHigh:"",dateStart:"",dateEnd:"",dateMax:(new Date).getFullYear(),SafeButtom:"",history:[],recode:[],arry:[],rest:[],applyType:_template2.default.applyType,contrast:_template2.default.contrast,applyTypeId:"",list:[],display:!0,index:1,size:10,block:!0,focus:!0,acid:"",page:1,bottom:!1},onSure:function(){var t=this.data.acid;this.setData({id:t,list:[],index:1,active:t}),this.onSearch(1,10,t-1),this.onClose(),this.anima(t,!0)},setValue:function(t){var a=this,e=t.currentTarget.dataset.id,i=t.currentTarget.dataset.type,s=this.data.history,n=this.data.recode;this.setData({focus:!1}),(0,_setTime2.default)(300).then(function(t){1==i?a.setData({value:s[e]}):a.setData({value:n[e]}),a.onSearch()})},onClear:function(){this.setData({list:[],value:"",page:1})},onPageScroll:function(t){var a=t.scrollTop,e=this.data.block;a>600&&1==e&&this.setData({block:!1}),a<500&&0==e&&this.setData({block:!0})},onTop:function(){wx.pageScrollTo({scrollTop:0})},onDelet:function(){var t=this;_dialog2.default.confirm({title:"提示",message:"是否删除历史记录"}).then(function(){wx.setStorageSync("history",[]),t.setData({history:[]})}).catch(function(){})},onHistory:function(t){var a=this.data.history;if(0==a.length){var e=[];e.push(t),this.setData({history:e}),wx.setStorageSync("history",this.data.history)}else-1==a.indexOf(t)&&a.push(t),this.setData({history:a}),wx.setStorageSync("history",this.data.history)},onCheck:function(t){var a=t.currentTarget.dataset.id,e=this.data.applyType.slice(0,this.data.applyType.length);0==e[a].isSelect?(e[a].isSelect=!0,this.setData({applyType:e})):(e[a].isSelect=!1,this.setData({applyType:e})),this.onId()},onId:function(){for(var t=this.data.applyType.slice(0,this.data.applyType.length),a=[],e=0;e<t.length;e++)1==t[e].isSelect&&a.push(JSON.parse(t[e].id));var i=a.join(",");this.setData({applyTypeId:i})},onChange:function(t){this.setData({value:t.detail}),t.detail||this.setData({list:[],value:"",page:1})},onRest:function(){for(var t=this.data.applyType.slice(0,this.data.applyType.length),a=0;a<t.length;a++)1==t[a].isSelect&&(t[a].isSelect=!1);this.setData({applyType:t,applyTypeId:""})},onClose:function(){this.setData({show:!this.data.show})},toast:function(){_toast2.default.loading({message:"加载中...",duration:0})},anima:function(t,a){var e=this.data.wid,i=e/100*20;if(a)var s=t;else var s=t.currentTarget.dataset.id;0==s&&(this.setData({id:1,list:[],index:1,page:1}),this.onSearch(1,10,1)),1==s&&(this.setData({id:2,list:[],index:1,page:1}),this.onSearch(1,10,2)),2==s&&(this.setData({id:3,list:[],index:1,page:1}),this.onSearch(1,10,3)),3==s&&(this.setData({id:4,list:[],index:1,page:1}),this.onSearch(1,10,4)),4==s&&(this.data.acid=this.data.id-1,this.onClose(),this.setData({id:4,list:[],index:1,page:1}));var n=wx.createAnimation({duration:1e3,timingFunction:"ease"});this.animation=n,n.translateX(s*i).step({duration:300}),this.setData({animationData:this.animation.export()})},getInfo:function(){var t=getApp().globalData.sysinfo;this.setData({wid:t.windowWidth,SafeHigh:t.screenHeight,SafeButtom:t.statusBarHeight})},getData:function(){this.getHotData(),this.getInfo()},bindDateChange:function(t){var a=t.currentTarget.dataset.id;1==a&&this.setData({dateStart:t.detail.value}),2==a&&this.setData({dateEnd:t.detail.value})},onSearch:function(t,a,e){var i=this,s=this.data.bottom;if(!1===s&&this.setData({list:[]}),this.setData({display:!1}),!t||!a)var t=1,a=10;if(e)var n=e;else var n=this.data.id;var o=this.data.dateStart,r=this.data.dateEnd,d=this.data.value,l=this.data.display;if(!d)return void this.notify("请先输入！");if(this.onHistory(d),o&&r)var h=o+"至"+r;else var h="";if(this.data.applyTypeId)var u=this.data.applyTypeId;else var u="";l&&this.toast(),(0,_network2.default)({url:"/getdata",data:{type:n,date:h,cate_id:u,keywords:d,index:s?t:1,size:a,status:""}}).then(function(t){var a=t.data.data;if(s){var e=i.data.contrast,n=i.data.list.length;if(a.length>0){for(var o=0;o<a.length;o++){for(var r=0;r<e.length;r++)a[o].IntCls==e[r].id&&(a[o].genre=e[r].name);var d=n+o;i.setData(_defineProperty({},"list["+d+"]",a[o]))}i.data.page++}}else{var e=i.data.contrast,n=i.data.list.length;if(a.length>0){for(var o=0;o<a.length;o++)for(var r=0;r<e.length;r++)a[o].IntCls==e[r].id&&(a[o].genre=e[r].name);i.setData({list:a}),i.data.page=1}}_toast2.default.clear(),i.setData({display:!0}),_toast2.default.clear(),i.data.bottom=!1}).catch(function(t){_toast2.default.clear()})},getHotData:function(){var t=this,a=wx.getStorageSync("hotArry");a&&this.setData({recode:a,history:wx.getStorageSync("history")}),(0,_network2.default)({url:"/searchhot",data:{}}).then(function(a){t.setData({recode:a.data.data}),wx.setStorageSync("hotArry",a.data.data)})},notify:function(t){(0,_notify2.default)({text:t,duration:1e3,selector:"#custom-selector",backgroundColor:"#f44",color:"#fff"})},onDt:function(t){var a=t.currentTarget.dataset.id,e=t.currentTarget.dataset.type,i=t.currentTarget.dataset.index,s=this.data.list[i];wx.setStorageSync("list",s);var n=this.data.value;wx.navigateTo({url:"/pages/index/search/dt/dt?id="+a+"&type="+e+"&value="+n})},onClick:function(t){t.detail.index?(0,_toast2.default)("敬请期待！"):_toast2.default.clear()},onLoad:function(t){this.getData(),this.setData({value:t.id})},onReachBottom:function(){this.data.bottom=!0;var t=this.data.page,a=this.data.size,e=this.data.id;this.data.index=t,this.onSearch(t,a,e)}});